name: Integration test
on: [push, pull_request]
jobs:
  test-on-ubuntu:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Set-up Python venv
        run: python3 -m venv .venv
      - name: Install Spot
        run: |
          ## Download the source code of spot
          wget http://www.lrde.epita.fr/dload/spot/spot-2.11.5.tar.gz
          tar xvf spot-2.11.5.tar.gz
          cd spot-2.11.5
          # Specify appropriate CPU/OS for your environment
          ./configure --prefix "$OLDPWD/.venv/" --build=x86_64-unknown-linux-gnu --host=x86_64-unknown-linux-gnu
          # Build and install Spot
          make -j8 && make install
      - name: Install AALpy
        run: |
          git clone https://github.com/DES-Lab/AALpy
          cd AALpy
          patch -p1 < ../aalpy.patch
          python3 -m pip install pydot
          sudo python3 setup.py install
      - name: Install other packages
        run: |
          . .venv/bin/activate
          pip install -r requirements.txt
      - name: Run src/main.py as an integration test
        run: |
          . .venv/bin/activate
          python3 src/main.py \
            --model-file benchmarks/mqtt/mqtt.dot \
            --prop-file benchmarks/mqtt/mqtt.props \
            --prism-path foo/bin/prism \
            --output-dir result \
            --min-rounds 3 \
            --max-rounds 5 \
            --save-files-for-each-round \
            --target-unambiguity 0.99
